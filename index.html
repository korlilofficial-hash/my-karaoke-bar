<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART Karaoke Launcher</title>
    <script src="https://www.gstatic.com"></script>
    <script src="https://www.gstatic.com"></script>
    <style>
        :root { --blue: #0077ff; --dark: #0a0a0c; --card: #1a1a1d; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; }
        .header { padding: 20px; background: #000; border-bottom: 2px solid var(--blue); }
        .player-section { padding: 20px; }
        iframe#main-player { width: 100%; max-width: 800px; height: 450px; border-radius: 15px; border: 1px solid #333; }
        
        /* –ü–æ–∏—Å–∫ */
        .search-area { padding: 20px; background: var(--card); margin: 10px auto; max-width: 600px; border-radius: 15px; }
        input { width: 70%; padding: 12px; border-radius: 8px; border: none; outline: none; }
        .btn-search { background: var(--blue); color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* –û—á–µ—Ä–µ–¥—å */
        .queue-item { display: flex; justify-content: space-between; align-items: center; background: var(--card); margin: 10px auto; padding: 15px; max-width: 600px; border-radius: 10px; border-left: 5px solid var(--blue); }
        .btn-play { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .btn-del { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 5px; }

        /* –û–∫–Ω–æ –≤—ã–±–æ—Ä–∞ (–ü–æ–∏—Å–∫) */
        #search-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; flex-direction: column; }
        .close-search { padding: 15px; background: red; color: white; cursor: pointer; font-weight: bold; }
        #search-iframe { flex-grow: 1; border: none; }
    </style>
</head>
<body>

<div class="header">
    <h1>üé§ SMART KARAOKE</h1>
</div>

<div class="player-section">
    <iframe id="main-player" src="" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>
</div>

<div class="search-area">
    <input type="text" id="song-query" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏...">
    <button class="btn-search" onclick="openSearch()">–ù–ê–ô–¢–ò</button>
    <p style="font-size: 12px; color: #888; margin-top: 10px;">–ù–∞–∂–º–∏ –Ω–∞–π—Ç–∏, –≤—ã–±–µ—Ä–∏ –≤–∏–¥–µ–æ –∏ —Å–∫–æ–ø–∏—Ä—É–π –µ–≥–æ –∞–¥—Ä–µ—Å</p>
</div>

<div id="queue-list"></div>

<!-- –û–∫–Ω–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –í–ö -->
<div id="search-overlay">
    <div class="close-search" onclick="closeSearch()">‚ùå –ó–ê–ö–†–´–¢–¨ –ü–û–ò–°–ö –ò –í–ï–†–ù–£–¢–¨–°–Ø</div>
    <iframe id="search-iframe" src=""></iframe>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBorratezI1ExpJ3j7euvgNuJHGBzvEMqk",
        authDomain: "my-caraoke-bar.firebaseapp.com",
        databaseURL: "https://my-caraoke-bar-default-rtdb.firebaseio.com",
        projectId: "my-caraoke-bar",
        storageBucket: "my-caraoke-bar.firebasestorage.app",
        messagingSenderId: "962264196959",
        appId: "1:962264196959:web:d3db4e060adf0e746f38ea"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∏—Å–∫–∞
    function openSearch() {
        const query = document.getElementById('song-query').value;
        if (!query) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ!');
        
        const searchUrl = `https://vk.com{encodeURIComponent(query + ' –∫–∞—Ä–∞–æ–∫–µ')}`;
        document.getElementById('search-iframe').src = searchUrl;
        document.getElementById('search-overlay').style.display = 'flex';
    }

    function closeSearch() {
        document.getElementById('search-overlay').style.display = 'none';
        // –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–æ—Å–∏–º –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Ç–∞—â–∏—Ç—å —Å—Å—ã–ª–∫—É –∏–∑ —á—É–∂–æ–≥–æ iframe –Ω–µ–ª—å–∑—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
        const url = prompt("–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ:");
        if (url) {
            db.ref('karaoke_queue').push({
                url: url,
                title: "–ù–æ–≤—ã–π –∑–∞–∫–∞–∑",
                time: Date.now()
            });
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—á–µ—Ä–µ–¥–∏
    db.ref('karaoke_queue').on('value', (snap) => {
        const list = document.getElementById('queue-list');
        list.innerHTML = '';
        const data = snap.val();
        if (data) {
            Object.keys(data).forEach(id => {
                const song = data[id];
                list.innerHTML += `
                    <div class="queue-item">
                        <span>üéµ ${song.url.substring(0, 30)}...</span>
                        <div>
                            <button class="btn-play" onclick="play('${song.url}')">–ü–ï–¢–¨</button>
                            <button class="btn-del" onclick="del('${id}')">‚ùå</button>
                        </div>
                    </div>
                `;
            });
        }
    });

    function play(url) {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –í–ö –≤ Embed
        let embed = url;
        if (url.includes('video')) {
            const match = url.match(/video(-?\d+)_(\d+)/);
            if (match) embed = `https://vk.com{match[1]}&id=${match[2]}&hash=0`;
        }
        document.getElementById('main-player').src = embed;
    }

    function del(id) { db.ref('karaoke_queue/' + id).remove(); }
</script>

</body>
</html>
