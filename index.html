<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARAOKE SYSTEM</title>
    <script src="https://www.gstatic.com"></script>
    <script src="https://www.gstatic.com"></script>
    <style>
        body { background: #0a0a0c; color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .hidden { display: none !important; }
        .card { background: #1a1a1d; padding: 20px; border-radius: 15px; border: 1px solid #333; max-width: 600px; margin: 0 auto; }
        iframe { width: 100%; height: 400px; border-radius: 10px; border: 2px solid #0077ff; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-blue { background: #0077ff; color: white; }
        .btn-green { background: #28a745; color: white; }
        .item { background: #222; padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <!-- –ò–ù–¢–ï–†–§–ï–ô–° –≠–ö–†–ê–ù–ê (–ü–õ–ê–ù–®–ï–¢) -->
    <div id="screen-view" class="hidden">
        <h1>üì∫ –≠–ö–†–ê–ù –ö–ê–†–ê–û–ö–ï</h1>
        <iframe id="main-player" src="" allow="autoplay; encrypted-media; fullscreen"></iframe>
        <div id="screen-queue" style="text-align: left; margin-top: 20px;"></div>
    </div>

    <!-- –ò–ù–¢–ï–†–§–ï–ô–° –ü–£–õ–¨–¢–ê (–ì–û–°–¢–¨) -->
    <div id="guest-view" class="hidden">
        <div class="card">
            <h2>üé§ –ü–£–õ–¨–¢ –ì–û–°–¢–Ø</h2>
            <div id="step1">
                <p>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ VK:</p>
                <input type="text" id="query" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–µ–ø—Å –†—é–º–∫–∞...">
                <button class="btn-blue" onclick="goSearch()">üîç –ù–ê–ô–¢–ò</button>
            </div>
            <div id="step2" style="display:none;">
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞:</p>
                <input type="text" id="v-url" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –í–ö...">
                <button class="btn-green" onclick="send()">‚úÖ –û–¢–ü–†–ê–í–ò–¢–¨</button>
                <button onclick="location.reload()" style="background:#444; color:#fff;">–ù–ê–ó–ê–î</button>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBorratezI1ExpJ3j7euvgNuJHGBzvEMqk",
        authDomain: "my-caraoke-bar.firebaseapp.com",
        databaseURL: "https://my-caraoke-bar-default-rtdb.firebaseio.com",
        projectId: "my-caraoke-bar",
        storageBucket: "my-caraoke-bar.firebasestorage.app",
        messagingSenderId: "962264196959",
        appId: "1:962264196959:web:d3db4e060adf0e746f38ea"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –û–ü–†–ï–î–ï–õ–Ø–ï–ú –†–û–õ–¨
    const urlParams = new URLSearchParams(window.location.search);
    const isGuest = urlParams.has('p'); // –ï—Å–ª–∏ –≤ —Å—Å—ã–ª–∫–µ –µ—Å—Ç—å ?p=...

    if (isGuest) {
        document.getElementById('guest-view').classList.remove('hidden');
    } else {
        document.getElementById('screen-view').classList.remove('hidden');
        initScreen();
    }

    // –õ–û–ì–ò–ö–ê –ì–û–°–¢–Ø
    function goSearch() {
        const q = document.getElementById('query').value;
        if(q) {
            window.open(`https://vk.com{encodeURIComponent(q + ' –∫–∞—Ä–∞–æ–∫–µ')}`, '_blank');
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
        }
    }
    function send() {
        const url = document.getElementById('v-url').value;
        const match = url.match(/video(-?\d+)_(\d+)/);
        if (match) {
            const clean = `https://vk.com{match[1]}&id=${match[2]}&hash=0`;
            db.ref('karaoke_q').push({ url: clean, title: "–ó–∞–∫–∞–∑ –≥–æ—Å—Ç—è" });
            alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
            location.reload();
        } else { alert("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ –í–ö!"); }
    }

    // –õ–û–ì–ò–ö–ê –≠–ö–†–ê–ù–ê
    function initScreen() {
        db.ref('karaoke_q').on('value', snap => {
            const list = document.getElementById('screen-queue');
            list.innerHTML = '<h3>–û–ß–ï–†–ï–î–¨:</h3>';
            const data = snap.val();
            if (data) {
                Object.keys(data).forEach(id => {
                    list.innerHTML += `<div class="item">
                        <span>üéµ –ü–µ—Å–Ω—è –∑–∞–∫–∞–∑–∞–Ω–∞</span>
                        <div>
                            <button onclick="playSong('${data[id].url}')" style="width:auto; background:#28a745; margin:0 5px;">‚ñ∂</button>
                            <button onclick="delSong('${id}')" style="width:auto; background:#dc3545; margin:0;">‚ùå</button>
                        </div>
                    </div>`;
                });
            }
        });
    }
    function playSong(url) { document.getElementById('main-player').src = url; }
    function delSong(id) { db.ref('karaoke_q/' + id).remove(); }
</script>
</body>
</html>
